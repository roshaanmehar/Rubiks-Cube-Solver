<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Two Nets (HTML+JS, 180° Reflection for Shared Faces)</title>
  <style>
    body {
      margin: 0; 
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .nets {
      display: flex; 
      gap: 30px; 
      justify-content: center; 
      flex-wrap: wrap;
    }
    .net-container {
      text-align: center;
    }
    .grid9x9 {
      display: grid;
      grid-template-columns: repeat(9, 40px);
      grid-template-rows: repeat(9, 40px);
      gap: 1px;
      margin-bottom: 20px;
    }
    .cell {
      width: 40px; 
      height: 40px;
      border: 1px solid #333;
      display: flex; 
      align-items: center; 
      justify-content: center;
      font-size: 11px;
      color: rgba(0, 0, 0, 0.5);
      cursor: pointer;
      box-sizing: border-box;
    }
    .empty {
      border: none; 
      cursor: default;
    }
    .center {
      font-weight: bold;
      color: rgba(0, 0, 0, 0.8);
      cursor: default;
    }

    .controls {
      margin-top: 20px;
      display: flex; 
      gap: 20px; 
      justify-content: center; 
      flex-wrap: wrap;
    }
    .control-panel {
      background: #fff; 
      border-radius: 8px; 
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 15px; 
      min-width: 280px;
    }
    .buttons {
      display: grid; 
      grid-template-columns: repeat(3, 1fr);
      gap: 8px; 
      margin-top: 10px;
    }
    button {
      padding: 8px;
      border: none;
      border-radius: 4px;
      background-color: #4299e1;
      color: #fff;
      cursor: pointer;
      font-weight: 500;
    }
    button:hover {
      background-color: #3182ce;
    }

    /* Modal for color picker */
    .modal {
      position: fixed;
      top: 0; 
      left: 0;
      width: 100%; 
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex; 
      justify-content: center; 
      align-items: center;
      z-index: 999;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 300px;
    }
    .color-picker {
      display: grid; 
      grid-template-columns: repeat(3, 1fr);
      gap: 8px; 
      margin-bottom: 15px;
    }
    .color-option {
      width: 40px; 
      height: 40px;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      cursor: pointer;
    }
    .color-option:hover {
      border: 2px solid #000;
    }
    .cancel-btn {
      width: 100%;
      background-color: #6c757d;
    }
    .cancel-btn:hover {
      background-color: #5a6268;
    }
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Two Nets with 180° Reflection for Shared Faces</h1>

  <div class="nets">
    <!-- White-center net -->
    <div class="net-container">
      <h2>White-Center Layout</h2>
      <div id="whiteNet" class="grid9x9"></div>
    </div>
    <!-- Yellow-center net -->
    <div class="net-container">
      <h2>Yellow-Center Layout</h2>
      <div id="yellowNet" class="grid9x9"></div>
    </div>
  </div>

  <!-- Controls -->
  <div class="controls">
    <div class="control-panel">
      <h2>Rotate a Face</h2>
      <p>Rotates the face clockwise. Rotates only that side's 3×3 orientation (no adjacency).</p>

      <h3>White Net Faces</h3>
      <div class="buttons">
        <button data-side="white" data-face="b">B</button>
        <button data-side="white" data-face="o">O</button>
        <button data-side="white" data-face="r">R</button>
        <button data-side="white" data-face="g">G</button>
        <button data-side="white" data-face="w">W</button>
      </div>

      <h3>Yellow Net Faces</h3>
      <div class="buttons">
        <button data-side="yellow" data-face="b">B</button>
        <button data-side="yellow" data-face="o">O</button>
        <button data-side="yellow" data-face="r">R</button>
        <button data-side="yellow" data-face="g">G</button>
        <button data-side="yellow" data-face="y">Y</button>
      </div>
    </div>
    <div class="control-panel">
      <h2>Explanation</h2>
      <ul>
        <li>Faces B/O/R/G are <em>shared</em> across both nets. If you recolor index i on one net, index (8−i) on the other net gets that color (180° reflection).</li>
        <li>Faces W and Y are <em>unlinked</em> (White net only, Yellow net only).</li>
        <li>Rotations only affect local orientation. B on White can differ from B on Yellow.</li>
      </ul>
    </div>
  </div>
</div>

<!-- Color Picker Modal -->
<div id="colorModal" class="modal hidden">
  <div class="modal-content">
    <h3>Select a Color</h3>
    <div class="color-picker">
      <!-- Red -->
      <div class="color-option" style="background-color:#ff0000" data-color="#ff0000"></div>
      <!-- Orange -->
      <div class="color-option" style="background-color:#ffa500" data-color="#ffa500"></div>
      <!-- White -->
      <div class="color-option" style="background-color:#ffffff" data-color="#ffffff"></div>
      <!-- Yellow -->
      <div class="color-option" style="background-color:#ffff00" data-color="#ffff00"></div>
      <!-- Green -->
      <div class="color-option" style="background-color:#00ff00" data-color="#00ff00"></div>
      <!-- Blue -->
      <div class="color-option" style="background-color:#0000ff" data-color="#0000ff"></div>
    </div>
    <button id="cancelColor" class="cancel-btn">Cancel</button>
  </div>
</div>

<script>
// The rest of the script remains the same, with the critical change being the `setColor` function:

function setColor(faceName, index, color) {
  const arr = getFaceArray(faceName);
  if (!arr) {
    console.error(`Face array not found for: ${faceName}`);
    return;
  }
  
  if (index < 0 || index >= arr.length) {
    console.error(`Invalid index ${index} for face ${faceName}`);
    return;
  }
  
  arr[index] = color;

  // If it's W or Y => do nothing else
  if (faceName === 'wW' || faceName === 'yY') return;

  // If face is among b/o/r/g => reflect to the other side at index 8 - i
  const reflectionMap = {
    0: 8, 1: 7, 2: 6,
    3: 5, 4: 4, 5: 3,
    6: 2, 7: 1, 8: 0
  };

  if (faceName.length !== 2) {
    console.error(`Invalid face name format: ${faceName}`);
    return;
  }
  
  const faceChar = faceName[0]; // b/o/r/g
  const sideChar = faceName[1]; // 'W' or 'Y'

  if (!faceChar || !sideChar) {
    console.error(`Invalid face name: ${faceName}`);
    return;
  }

  let otherFaceName = "";
  if (sideChar === 'W') {
    // e.g. "bW" => "bY"
    otherFaceName = faceChar + "Y";
  } else if (sideChar === 'Y') {
    // e.g. "bY" => "bW"
    otherFaceName = faceChar + "W";
  } else {
    console.error(`Invalid side character: ${sideChar}`);
    return;
  }
  
  const otherArr = getFaceArray(otherFaceName);
  if (!otherArr) {
    console.error(`Other face array not found for: ${otherFaceName}`);
    return;
  }
  
  // Use the reflection map for the 180-degree rotation
  const otherIndex = reflectionMap[index];
  
  if (otherIndex < 0 || otherIndex >= otherArr.length) {
    console.error(`Invalid other index ${otherIndex} for face ${otherFaceName}`);
    return;
  }
  
  otherArr[otherIndex] = color;
}
</script>
</body>
</html>